<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Traitement en cours...</title>
    <script>
      const sessionId = new URLSearchParams(window.location.search).get(
        "session_id"
      );

      async function checkPaymentStatus() {
        const response = await fetch(
          `/api/check-payment?session_id=${sessionId}`
        );
        const data = await response.json();

        if (data.status === "Completed") {
          window.location.href = "/success"; // Redirection vers la page de succès
        } else if (data.status === "not_found") {
          document.getElementById("status").innerText = "Paiement introuvable.";
        } else {
          setTimeout(checkPaymentStatus, 3000); // Vérifier toutes les 3 secondes
        }
      }

      checkPaymentStatus();
    </script>
  </head>
  <body>
    <h1>Votre paiement est en cours de traitement...</h1>
    <p id="status">Merci de patienter pendant la validation.</p>
  </body>
</html>
